#!/bin/csh
#
# Generated by CHARMM-GUI (http://www.charmm-gui.org)
#
# 1) Use Gromacs 5.1 or newer to run these simulations
#

# Minimization
setenv GMX_MAXCONSTRWARN -1
# step6.0 - soft-core minimization
gmx grompp -f step6.0_equilibration.mdp -o step6.0_equilibration.tpr -c step5_assembly.box.pdb -p system.top -n index.ndx
gmx mdrun -deffnm step6.0_equilibration -ntomp 6 -v

# step6.1
gmx grompp -f step6.1_equilibration.mdp -o step6.1_equilibration.tpr -c step6.0_equilibration.gro -p system.top -n index.ndx
gmx mdrun -deffnm step6.1_equilibration -ntomp 6 -v
unsetenv GMX_MAXCONSTRWARN

# Equilibration
set cnt    = 2
set cntmax = 6

while ( ${cnt} <= ${cntmax} )
    @ pcnt = ${cnt} - 1
    gmx grompp -f step6.${cnt}_equilibration.mdp -o step6.${cnt}_equilibration.tpr -c step6.${pcnt}_equilibration.gro -p system.top -n index.ndx
    gmx mdrun -deffnm step6.${cnt}_equilibration -ntomp 6 -v
    @ cnt += 1
end

# Production
gmx grompp -f step7_production.mdp -o step7_production.tpr -c step6.6_equilibration.gro -p system.top -n index.ndx -maxwarn 5
gmx mdrun -deffnm step7_production -ntomp 6 -v
gmx grompp -f step8_production.mdp -o step8_production.tpr -c step7_production.gro -p system.top -n index.ndx -maxwarn 5
gmx mdrun -deffnm step8_production -ntomp 6 -v
dynsf --threads=8 --verbose --trajectory=./step8_production.trr --op=dsf.pickle --om=dsf.m  --off-direction=z  --nt=500 --max-frames=1000 --k-max=10 --k-bins=21 --index=./index.ndx
